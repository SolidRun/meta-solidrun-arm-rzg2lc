From 9bc35393c04cc66dfc5ac30b53e0ec3f6c3f3a44 Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Wed, 31 Jul 2024 15:42:30 +0300
Subject: [PATCH] arm64: dts: add description for renesas eu205 eval board

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 arch/arm64/boot/dts/renesas/Makefile         |   2 +
 arch/arm64/boot/dts/renesas/rzg2l-eu205.dts  | 545 +++++++++++++++++++
 arch/arm64/boot/dts/renesas/rzg2lc-eu205.dts | 486 +++++++++++++++++
 arch/arm64/configs/rz-solidrun_defconfig     |  18 +-
 4 files changed, 1046 insertions(+), 5 deletions(-)
 create mode 100644 arch/arm64/boot/dts/renesas/rzg2l-eu205.dts
 create mode 100644 arch/arm64/boot/dts/renesas/rzg2lc-eu205.dts

diff --git a/arch/arm64/boot/dts/renesas/Makefile b/arch/arm64/boot/dts/renesas/Makefile
index 0a7cfb70f..dac25d19f 100644
--- a/arch/arm64/boot/dts/renesas/Makefile
+++ b/arch/arm64/boot/dts/renesas/Makefile
@@ -90,6 +90,7 @@ dtb-$(CONFIG_ARCH_R9A07G043) += r9a07g043u11-dev.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += r9a07g044c2-smarc.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += rzg2lc-hummingboard.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += rzg2lc-compact.dtb
+dtb-$(CONFIG_ARCH_R9A07G044) += rzg2lc-eu205.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += r9a07g044c2-dev.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += r9a07g044l2-smarc.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += r9a07g044l2-dev.dtb
@@ -97,6 +98,7 @@ dtb-$(CONFIG_ARCH_R9A07G044) += rzg2l-hummingboard-ripple.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += rzg2l-hummingboard-tutus.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += rzg2l-hummingboard-extended.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += rzg2l-hummingboard-pro.dtb
+dtb-$(CONFIG_ARCH_R9A07G044) += rzg2l-eu205.dtb
 
 dtb-$(CONFIG_ARCH_R9A07G054) += r9a07g054l2-smarc.dtb
 dtb-$(CONFIG_ARCH_R9A07G044) += r9a07g054l2-dev.dtb
diff --git a/arch/arm64/boot/dts/renesas/rzg2l-eu205.dts b/arch/arm64/boot/dts/renesas/rzg2l-eu205.dts
new file mode 100644
index 000000000..d1ba1eaf6
--- /dev/null
+++ b/arch/arm64/boot/dts/renesas/rzg2l-eu205.dts
@@ -0,0 +1,545 @@
+// SPDX-License-Identifier: GPL-2.0+
+/*
+ * Copyright (C) 2024 Josua Mayer <josua@solid-run.com>
+ *
+ * DTS for SolidRun RZ-G2L SoM,
+ * hosted on Renesas EU205 Evaluation Board.
+ *
+ */
+
+/dts-v1/;
+
+#include "rzg2l-sr-som.dtsi"
+//#include "rzx2xx-eu205.dtsi"
+
+/ {
+	model = "Renesas G2L EU205";
+	compatible = "solidrun,rz-eu205", "solidrun,rzg2l-sr-som", "renesas,r9a07g044l2", "renesas,r9a07g044";
+
+	aliases {
+		serial0 = &scif0;
+		serial1 = &scif1;
+		serial2 = &scif2;
+		serial4 = &scif4;
+		i2c0 = &i2c0;
+		i2c1 = &i2c1;
+		i2c2 = &i2c2;
+		i2c3 = &i2c3;
+		mmc0 = &sdhi0;
+		mmc1 = &sdhi1;
+		ethernet0 = &eth0;
+		ethernet1 = &eth1;
+	};
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	leds {
+		compatible = "gpio-leds";
+
+		led-0-red {
+			label = "d7:red";
+			gpios = <&clpd_gpio 0 GPIO_ACTIVE_LOW>;
+		};
+
+		led-0-green {
+			label = "d7:green";
+			gpios = <&clpd_gpio 1 GPIO_ACTIVE_LOW>;
+		};
+
+		led-0-blue {
+			label = "d7:blue";
+			gpios = <&clpd_gpio 2 GPIO_ACTIVE_LOW>;
+		};
+	};
+
+	mipi_backlight: backlight {
+		compatible = "gpio-backlight";
+		gpios = <&pinctrl RZG2L_GPIO(32, 1) GPIO_ACTIVE_LOW>;
+		power-supply = <&vdd_backlight>;
+	};
+
+	pps {
+		compatible = "pps-gpio";
+		gpios = <&pinctrl RZG2L_GPIO(6, 1) GPIO_ACTIVE_HIGH>;
+	};
+
+	vdd_1v8: regulator-vdd-1v8 {
+		/* on Carrier, from vdd-3v3 */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-1v8";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		vin-supply = <&vdd_3v3>;
+	};
+
+	vdd_3v3: regulator-vdd-3v3 {
+		/* on SoM, PMIC, buck3 */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-3v3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+	};
+
+	vdd_5v0: regulator-vdd-5v0 {
+		/* on Carrier, from VIN */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-5v0";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+	};
+
+	vdd_sd: regulator-vdd-sd {
+		compatible = "regulator-fixed";
+		model = "renesas,SLG59M157V";
+		regulator-name = "vdd-sd";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		vin-supply = <&vdd_3v3>;
+		gpios = <&pinctrl RZG2L_GPIO(4, 1) (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
+		enable-active-high;
+		regulator-boot-on;
+	};
+
+	/* switch for vdd2, sourced from VIN, supplies high-voltage io controller, can be exposed on J26 with R121 */
+	vdd_motor: regulator-vdd2-motor {
+		compatible = "regulator-fixed";
+		model = "renesas,SLG59H1019V";
+		regulator-name = "vdd2";
+		/* this voltage is variable, based on external power-supply voltage */
+		regulator-min-microvolt = <12000000>;
+		regulator-max-microvolt = <12000000>;
+		gpios = <&pinctrl RZG2L_GPIO(39, 2) GPIO_ACTIVE_HIGH>; // J7-28
+		enable-active-high;
+		regulator-always-on;
+	};
+
+	vdd2-output {
+		compatible = "regulator-output";
+		vout-supply = <&vdd_motor>;
+	};
+
+	/* vbat voltage for lte and wifi */
+	vbat_wireless: regulator-vbat-wireless {
+		compatible = "regulator-fixed";
+		model = "renesas,RAA214020";
+		regulator-name = "vbat";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+		vin-supply = <&vdd_5v0>;
+		gpios = <&pinctrl RZG2L_GPIO(42, 2) GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+		startup-delay-us = <100000>;
+		regulator-always-on;
+	};
+
+	/* lcd (dsi) backlight power 10.5V, enable J7-36 */
+	vdd_backlight: regulator-vdd-video {
+		compatible = "regulator-fixed";
+		model = "renesas,RAA211820";
+		regulator-name = "vdd-video";
+		regulator-min-microvolt = <10500000>;
+		regulator-max-microvolt = <10500000>;
+		gpios = <&pinctrl RZG2L_GPIO(36, 1) GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+	};
+
+	/* power-button SW1 J9-62 to pmic PWRON signal */
+};
+
+&canfd {
+	pinctrl-0 = <&can0_pins>, <&can1_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+
+	channel0 {
+		status = "okay";
+
+		can-transceiver {
+			max-bitrate = <1000000>;
+		};
+	};
+
+	channel1 {
+		status = "okay";
+
+		can-transceiver {
+			max-bitrate = <1000000>;
+		};
+	};
+};
+
+&dsi0 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	panel@0 {
+		/* this is not the correct driver, but close enough for proof of concept */
+		compatible = "ronbo,rb070d30";
+		reg = <0>;
+		vcc-lcd-supply = <&vdd_1v8>;
+		/* pulled up by panel to 1.8V, cpu gpio has 3.3V logic, use open-drain */
+		power-gpios = <&pinctrl RZG2L_GPIO(13, 1) (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
+		/* pulled up by panel to 1.8V, cpu gpio has 3.3V logic, use open-drain */
+		/* reset is active-low but ronbo driver inverts it internally */
+		reset-gpios = <&pinctrl RZG2L_GPIO(11, 1) (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
+		/* should be push-pull but cpu high-level is 3.3V, panel needs 1.8 max. */
+		updn-gpios = <&pinctrl RZG2L_GPIO(5, 0) (GPIO_ACTIVE_LOW|GPIO_OPEN_DRAIN)>;
+		/* should be push-pull but cpu high-level is 3.3V, panel needs 1.8 max. */
+		shlr-gpios = <&pinctrl RZG2L_GPIO(5, 2) (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
+		backlight = <&mipi_backlight>;
+		/* rotate 180 according to board and cable connection */
+		rotation = <180>;
+
+		port {
+			dsi_in_panel: endpoint {
+				remote-endpoint = <&dsi0_out>;
+			};
+		};
+	};
+};
+
+&dsi0_out {
+	remote-endpoint = <&dsi_in_panel>;
+};
+
+&du {
+	status = "okay";
+};
+
+/* PHY is on the SoM, should be enabled in SoM dts */
+&eth0 {
+	status = "okay";
+
+	// TODO: describe PHY LEDs
+};
+
+&eth1 {
+	status = "okay";
+
+	// TODO: describe PHY LEDs
+};
+
+&ehci0 {
+	dr_mode = "otg";
+	status = "okay";
+};
+
+&ehci1 {
+	dr_mode = "host";
+	status = "okay";
+};
+
+&i2c0 {
+	pinctrl-0 = <&i2c0_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+
+	clpd_gpio: gpio@8 {
+		compatible = "renesas,slg46826-gpio";
+		reg = <0x8>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+
+	eeprom@b {
+		/* SLG46826V emulated eeprom */
+		compatible = "atmel,24c02";
+		reg = <0xb>;
+		pagesize = <1>;
+	};
+
+	/* HS4003 temp/humidity (U18) @ 54 */
+
+	/* ZMOD4410AI1R air quality (U20) @ 32 */
+	co2-sensor@32 {
+		compatible = "renesas,zmod4410"; // no driver
+		reg = <0x32>;
+		reset-gpios = <&pinctrl RZG2L_GPIO(32, 0) GPIO_ACTIVE_LOW>;
+		interrupt-parent = <&pinctrl>;
+		interrupts = <RZG2L_GPIO(33, 0) IRQ_TYPE_EDGE_FALLING>;
+	};
+
+	/* ISL76683AROZ-T7A ambient (U19) @ 44 */
+	light-sensor@44 {
+		/*
+		 * 76683 only hs some similarities with 76682.
+		 * The register set in particular is substantially different.
+		 * There is no driver (yet) for 76683.
+		 */
+		compatible = "isil,isl76683";
+		reg = <0x44>;
+	};
+
+	/* ADXL345 accelerometer (U17) @ 3A / 53 depend on pin 12 */
+	accelerometer@53 {
+		compatible = "adi,adxl345";
+		reg = <0x53>;
+	};
+
+	/* R1EX24002ASAS0I#S0 eeprom (U26) @ 1010111 0x57 */
+	carrier_eeprom: eeprom@57 {
+		compatible = "atmel,24c02";
+		reg = <0x57>;
+		pagesize = <16>;
+	};
+};
+
+&i2c1 {
+	/* routed to CSI connector (J10) */
+	/* routed to DSI connector (J15) */
+
+	touchscreen@41 {
+		compatible = "ilitek,ili2130", "ilitek,ili210x";
+		reg = <0x41>;
+		interrupt-parent = <&pinctrl>;
+		interrupts = <RZG2L_GPIO(12, 0) IRQ_TYPE_EDGE_FALLING>;
+		reset-gpios = <&pinctrl RZG2L_GPIO(13, 2) GPIO_ACTIVE_LOW>;
+	};
+
+	/* MIA-M10Q gps @ 0x42 (no driver, similar neo-m8 ) */
+	/*gnss_ddc: gnss@42 {
+		compatible = "u-blox,mia-m10";
+		reg = <0x42>;
+	};*/
+
+	/* SLG47115V (U22) high voltage programmable IO controller (no driver) */
+};
+
+&ohci0 {
+	dr_mode = "otg";
+	status = "okay";
+};
+
+&ohci1 {
+	dr_mode = "host";
+	status = "okay";
+};
+
+&pinctrl {
+	can0_pins: can-0-pins {
+		pinmux = <RZG2L_PORT_PINMUX(10, 1, 2)>, /* CAN0_TX */
+			 <RZG2L_PORT_PINMUX(11, 0, 2)>; /* CAN0_RX */
+	};
+
+	can1_pins: can-1-pins {
+		pinmux = <RZG2L_PORT_PINMUX(12, 1, 2)>, /* CAN1_TX */
+			 <RZG2L_PORT_PINMUX(13, 0, 2)>; /* CAN1_RX */
+	};
+
+	scif2_pins: scif-2-pins {
+		pinmux = <RZG2L_PORT_PINMUX(16, 0, 2)>, /* SCIF2_TXD */
+			 <RZG2L_PORT_PINMUX(16, 1, 2)>; /* SCIF2_RXD */
+	};
+
+	scif3_pins: scif-3-pins {
+		pinmux = <RZG2L_PORT_PINMUX(0, 0, 5)>, /* SCIF3_TXD */
+			 <RZG2L_PORT_PINMUX(0, 1, 5)>; /* SCIF3_RXD */
+	};
+
+	scif4_rx_pins: scif-4-rx-pins {
+		pinmux = <RZG2L_PORT_PINMUX(2, 1, 5)>; /* SCIF4_RXD */
+		bias-pull-up;
+	};
+
+	scif4_tx_pins: scif-4-tx-pins {
+		pinmux = <RZG2L_PORT_PINMUX(2, 0, 5)>; /* SCIF4_TXD */
+		bias-pull-up;
+	};
+
+	spi2_pins: spi-2-pins {
+		pinmux = <RZG2L_PORT_PINMUX(8, 0, 3)>, /* RSPI2_CK */
+			 <RZG2L_PORT_PINMUX(8, 1, 3)>, /* RSPI2_MOSI */
+			 <RZG2L_PORT_PINMUX(8, 2, 3)>, /* RSPI2_MISO */
+			 <RZG2L_PORT_PINMUX(9, 0, 3)>; /* RSPI2_SSL */
+	};
+
+	usb0_pins: usb-0-pins {
+		pinmux = <RZG2L_PORT_PINMUX(4, 0, 1)>; /* USB0_VBUSEN */
+			 //<RZG2L_PORT_PINMUX(5, 0, 0)>, /* PLACEHOLDER GPIO, NOT USB0_OVRCUR */
+			 //<RZG2L_PORT_PINMUX(7, 0, 0)>; /* PLACEHOLDER GPIO, NOT USB0_OVRCUR */
+	};
+
+	usb1_pins: usb-1-pins {
+		pinmux = <RZG2L_PORT_PINMUX(42, 0, 1)>, /* USB1_VBUSEN */
+			 //<RZG2L_PORT_PINMUX(29, 1, 0)>; /* PLACEHOLDER GPIO, NOT USB1_OVRCUR */
+			 //<RZG2L_PORT_PINMUX(38, 1, 0)>; /* PLACEHOLDER GPIO, NOT USB1_OVRCUR */
+			 <RZG2L_PORT_PINMUX(42, 1, 0)>; /* PLACEHOLDER GPIO, NOT USB1_OVRCUR, J9-12 */
+	};
+
+	/* rs485 conflicts with on-som bluetooth, hog bt-reg-on */
+	som-bt-reg-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(23, 0) GPIO_ACTIVE_LOW>;
+		output-high;
+		line-name = "som-bt-reg";
+	};
+
+	/* lte reset */
+	/* TODO: replace with rfkill device for Linux v6.3 or later */
+	lte-reset-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(45, 2) GPIO_ACTIVE_LOW>;
+		input;
+		line-name = "lte-reset";
+	};
+
+	/* TODO: use with scif3 rts-gpios */
+	lte-rts-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(3, 0) GPIO_ACTIVE_LOW>;
+		output-high;
+		line-name = "lte-rts";
+	};
+
+	/*
+	 * mipi-dsi signals:
+	 *
+	 * RZ_DSI_CLK_N:   J5001-11: AG18
+	 * RZ_DSI_CLK_P:   J5001-9:  AG17
+	 *
+	 * RZ_DSI_DATA0_N: J5001-12: AJ16
+	 * RZ_DSI_DATA0_P: J5001-14: AH16
+	 * RZ_DSI_DATA1_N: J5001-21: AJ17
+	 * RZ_DSI_DATA1_P: J5001-23: AH17
+	 * RZ_DSI_DATA2_N: J5001-15: AJ15
+	 * RZ_DSI_DATA2_P: J5001-17: AH15
+	 * RZ_DSI_DATA3_N: J5001-4:  AJ18
+	 * RZ_DSI_DATA3_P: J5001-6:  AH18
+	 *
+	 * DSI_RESET:      J7-43:    P11_1
+	 * DSI_STBY:       J7-47:    P13_1
+	 *
+	 * DSI_PWM_BL:     J7-40:    P32_1
+	 * DSI_L/R:        J7-37:    P5_2
+	 * DSI_U/D:        J7-39:    P5_0
+	 *
+	 * DSI_CTP_/RST:   J7-49:    P13_2
+	 * DSI_INT#:       J7-45:    P12_0
+	 */
+
+	/* PWR_OUT1 (J26-6) / DIG_OUT1 P39_1 */
+	/* PWR_OUT2 (J26-8) / DIG_OUT2 / clpd */
+	/* DIG_IN1 (J26-5) / bDIG_IN1 P17_0 */
+	/* DIG_IN2 (J26-7) / bDIG_IN2 clpd / SLG_INT P9_1 */
+};
+
+&scif1 {
+	pinctrl-0 = <&scif1_pins>;
+	pinctrl-names = "default";
+	uart-has-rtscts;
+	status = "okay";
+
+	bluetooth {
+		compatible = "renesas,DA14531";
+		reset-gpios = <&pinctrl RZG2L_GPIO(45, 1) GPIO_ACTIVE_HIGH>;
+		max-speed = <1000000>;
+	};
+};
+
+/* RS485 */
+&scif2 {
+	pinctrl-0 = <&scif2_pins>;
+	pinctrl-names = "default";
+	/*
+	 * SCIF driver does not (currently) support RS485.
+	 * Disable flow-control so that simple tx/rx work,
+	 * production use however needs to implement proper support
+	 * to avoid collisions.
+	 *
+	 * SCIF can't support RS485 by native flow-control state-machine,
+	 * define RTS/CTS as GPIOs instead.
+	 *
+	 * cts-gpios = <&pinctrl RZG2L_GPIO(17, 1) GPIO_ACTIVE_LOW>;
+	 * rts-gpios = <&pinctrl RZG2L_GPIO(17, 2) GPIO_ACTIVE_LOW>;
+	 * uart-has-rtscts;
+	 * linux,rs485-enabled-at-boot-time;
+	 */
+	status = "okay";
+
+	/* G2LC conflict with on-som bluetooth */
+	/delete-node/ bluetooth;
+};
+
+/* LTE */
+&scif3 {
+	pinctrl-0 = <&scif3_pins>;
+	pinctrl-names = "default";
+	/*
+	 * SCIF driver does not support gpio rts/cts ...
+	 *
+	 * rts-gpios = <&pinctrl RZG2L_GPIO(3, 0) GPIO_ACTIVE_LOW>;
+	 */
+	/* disable dma to avoid kernel crashes on frame error */
+	/delete-property/ dmas;
+	/delete-property/ dma-names;
+	status = "okay";
+};
+
+/* GPS */
+&scif4 {
+	pinctrl-0 = <&scif4_rx_pins>, <&scif4_tx_pins>;
+	pinctrl-names = "default";
+	/* disable dma to avoid kernel crashes on frame error */
+	/delete-property/ dmas;
+	/delete-property/ dma-names;
+	status = "okay";
+
+	gnss {
+		compatible = "u-blox,mia-m10", "u-blox,neo-m8";
+		reset-gpios = <&pinctrl RZG2L_GPIO(7, 0) GPIO_ACTIVE_LOW>;
+		//timepulse-gpios = <&pinctrl RZG2L_GPIO(6, 1) GPIO_ACTIVE_HIGH>;
+		current-speed = <38400>;
+		u-blox,extint-gpios = <&pinctrl RZG2L_GPIO(7, 1) GPIO_ACTIVE_HIGH>;
+	};
+};
+
+/* eMMC / SD */
+&sdhi0 {
+	pinctrl-0 = <&sdhi0_pins>;
+	pinctrl-1 = <&sdhi0_pins_uhs>;
+	pinctrl-names = "default", "state_uhs";
+	vmmc-supply = <&vdd_sd>;
+	vqmmc-supply = <&reg_sdhi0_vccq>; // on SoM
+	bus-width = <4>;
+	cd-gpios = <&pinctrl RZG2L_GPIO(47, 0) GPIO_ACTIVE_LOW>;
+	status = "okay";
+};
+
+&spi1 {
+	pinctrl-0 = <&spi1_pins>;
+	pinctrl-names = "default";
+	dmas = <&dmac 0x2e99>, <&dmac 0x2e9a>;
+	dma-names = "tx", "rx";
+	status = "okay";
+
+	wifi@0 {
+		compatible = "renesas,da16xxx";
+		reg = <0>;
+		spi-max-frequency = <25000000>;
+		reset-gpios = <&pinctrl RZG2L_GPIO(45, 0) GPIO_ACTIVE_LOW>; // RTC_PWR_KEY
+		irq0-gpios = <&pinctrl RZG2L_GPIO(45, 3) (GPIO_ACTIVE_LOW)>;
+	};
+};
+
+&spi2 {
+	pinctrl-0 = <&spi2_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+
+	/* J13 */
+};
+
+&usb2_phy0 {
+	pinctrl-0 = <&usb0_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+};
+
+&usb2_phy1 {
+	pinctrl-0 = <&usb1_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/renesas/rzg2lc-eu205.dts b/arch/arm64/boot/dts/renesas/rzg2lc-eu205.dts
new file mode 100644
index 000000000..2498e2158
--- /dev/null
+++ b/arch/arm64/boot/dts/renesas/rzg2lc-eu205.dts
@@ -0,0 +1,486 @@
+// SPDX-License-Identifier: GPL-2.0+
+/*
+ * Copyright (C) 2024 Josua Mayer <josua@solid-run.com>
+ *
+ * DTS for SolidRun RZ-G2LC SoM,
+ * hosted on Renesas EU205 Evaluation Board.
+ *
+ */
+
+/dts-v1/;
+
+#include "rzg2lc-sr-som.dtsi"
+//#include "rzx2xx-eu205.dtsi"
+
+/ {
+	model = "Renesas G2LC EU205";
+	compatible = "solidrun,rz-eu205", "solidrun,rzg2lc-sr-som", "renesas,r9a07g044c2", "renesas,r9a07g044";
+
+	aliases {
+		serial0 = &scif0;
+		serial1 = &scif1;
+		i2c0 = &i2c0;
+		i2c1 = &i2c1;
+		i2c2 = &i2c2;
+		mmc0 = &sdhi0;
+		mmc1 = &sdhi1;
+		ethernet0 = &eth0;
+	};
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	leds {
+		compatible = "gpio-leds";
+
+		led-0-red {
+			label = "d7:red";
+			gpios = <&clpd_gpio 0 GPIO_ACTIVE_LOW>;
+		};
+
+		led-0-green {
+			label = "d7:green";
+			gpios = <&clpd_gpio 1 GPIO_ACTIVE_LOW>;
+		};
+
+		led-0-blue {
+			label = "d7:blue";
+			gpios = <&clpd_gpio 2 GPIO_ACTIVE_LOW>;
+		};
+	};
+
+	vbus1: regulator-usb-vbus-1 {
+		compatible = "regulator-fixed";
+		model = "renesas,SLG59M1639V";
+		regulator-name = "vbus-1";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+		vin-supply = <&vdd_5v0>;
+		/* pinmux automatic */
+		gpios = <&pinctrl RZG2L_GPIO(5, 0) GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+	};
+
+	vdd_1v8: regulator-vdd-1v8 {
+		/* on Carrier, from vdd-3v3 */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-1v8";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		vin-supply = <&vdd_3v3>;
+	};
+
+	vdd_3v3: regulator-vdd-3v3 {
+		/* on SoM, PMIC, buck3 */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-3v3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+	};
+
+	vdd_5v0: regulator-vdd-5v0 {
+		/* on Carrier, from VIN */
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-5v0";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+	};
+
+	vdd_sd: regulator-vdd-sd {
+		compatible = "regulator-fixed";
+		model = "renesas,SLG59M157V";
+		regulator-name = "vdd-sd";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		vin-supply = <&vdd_3v3>;
+		gpios = <&pinctrl RZG2L_GPIO(18, 1) (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
+		enable-active-high;
+		regulator-boot-on;
+	};
+
+	/* switch for vdd2, sourced from VIN, supplies high-voltage io controller, can be exposed on J26 with R121 */
+	vdd_motor: regulator-vdd2-motor {
+		compatible = "regulator-fixed";
+		model = "renesas,SLG59H1019V";
+		regulator-name = "vdd2";
+		/* this voltage is variable, based on external power-supply voltage */
+		regulator-min-microvolt = <12000000>;
+		regulator-max-microvolt = <12000000>;
+		gpios = <&pinctrl RZG2L_GPIO(39, 2) GPIO_ACTIVE_HIGH>; // J7-28
+		enable-active-high;
+		regulator-always-on;
+	};
+
+	vdd2-output {
+		compatible = "regulator-output";
+		vout-supply = <&vdd_motor>;
+	};
+
+	/* vbat voltage for lte and wifi */
+	vbat_wireless: regulator-vbat-wireless {
+		compatible = "regulator-fixed";
+		model = "renesas,RAA214020";
+		regulator-name = "vbat";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+		vin-supply = <&vdd_5v0>;
+		gpios = <&pinctrl RZG2L_GPIO(19, 1) GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+		startup-delay-us = <100000>;
+		regulator-always-on;
+	};
+
+	/* lcd (dsi) backlight power 10.5V, enable J7-36, floating on SoM */
+	vdd_backlight: regulator-vdd-video {
+		compatible = "regulator-fixed";
+		model = "renesas,RAA211820";
+		regulator-name = "vdd-video";
+		regulator-min-microvolt = <10500000>;
+		regulator-max-microvolt = <10500000>;
+	};
+
+	/* power-button SW1 J9-62 to pmic PWRON signal */
+
+};
+
+#if 0
+&canfd {
+	pinctrl-0 = <&can0_pins>, <&can1_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+
+	/* floating on G2LC SoM */
+
+	channel0 {
+		status = "okay";
+
+		can-transceiver {
+			max-bitrate = <1000000>;
+		};
+	};
+
+	channel1 {
+		status = "okay";
+
+		can-transceiver {
+			max-bitrate = <1000000>;
+		};
+	};
+};
+#endif
+
+&dsi0 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	panel@0 {
+		/* this is not the correct driver, but close enough for proof of concept */
+		compatible = "ronbo,rb070d30";
+		reg = <0>;
+		vcc-lcd-supply = <&vdd_1v8>;
+		/* all control IOs floating on SoM, hard-wired for always-on */
+
+		port {
+			dsi_in_panel: endpoint {
+				remote-endpoint = <&dsi0_out>;
+			};
+		};
+	};
+};
+
+	/*
+	 * mipi-dsi signals:
+	 *
+	 * RZ_DSI_DATA0_N: J5001-12
+	 * RZ_DSI_DATA0_P: J5001-14
+	 * RZ_DSI_DATA1_N: J5001-21
+	 * RZ_DSI_DATA1_P: J5001-23
+	 * RZ_DSI_DATA2_N: J5001-15
+	 * RZ_DSI_DATA2_P: J5001-17
+	 * RZ_DSI_DATA3_N: J5001-4
+	 * RZ_DSI_DATA3_P: J5001-6
+	 *
+	 * DSI_RESET:      J7-43, floating on SoM
+	 * DSI_STBY:       J7-47, floating on SoM
+	 *
+	 * DSI_PWM_BL:     J7-40, floating on SoM
+	 * DSI_L/R:        J7-37, floating on SoM
+	 * DSI_U/D:        J7-39, floating on SoM
+	 */
+
+&dsi0_out {
+	remote-endpoint = <&dsi_in_panel>;
+};
+
+&du {
+	status = "okay";
+};
+
+/* PHY is on the SoM, should be enabled in SoM dts */
+&eth0 {
+	status = "okay";
+
+	// TODO: describe PHY LEDs
+};
+
+&ehci0 {
+	dr_mode = "otg";
+	status = "okay";
+};
+
+&ehci1 {
+	dr_mode = "host";
+	status = "okay";
+};
+
+&i2c0 {
+	clpd_gpio: gpio@8 {
+		compatible = "renesas,slg46826-gpio";
+		reg = <0x8>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+
+	eeprom@b {
+		/* SLG46826V emulated eeprom */
+		compatible = "atmel,24c02";
+		reg = <0xb>;
+		pagesize = <1>;
+	};
+
+	/* HS4003 temp/humidity (U18) @ 54 */
+
+	/* ZMOD4410AI1R air quality (U20) @ 32 */
+	co2-sensor@32 {
+		compatible = "renesas,zmod4410"; // no driver
+		reg = <0x32>;
+		reset-gpios = <&pinctrl RZG2L_GPIO(32, 0) GPIO_ACTIVE_LOW>;
+		interrupt-parent = <&pinctrl>;
+		interrupts = <RZG2L_GPIO(33, 0) IRQ_TYPE_EDGE_FALLING>;
+	};
+
+	/* ISL76683AROZ-T7A ambient (U19) @ 44 */
+	light-sensor@44 {
+		/*
+		 * 76683 only hs some similarities with 76682.
+		 * The register set in particular is substantially different.
+		 * There is no driver (yet) for 76683.
+		 */
+		compatible = "isil,isl76683";
+		reg = <0x44>;
+	};
+
+	/* ADXL345 accelerometer (U17) @ 3A / 53 depend on pin 12 */
+	accelerometer@53 {
+		compatible = "adi,adxl345";
+		reg = <0x53>;
+	};
+
+	/* R1EX24002ASAS0I#S0 eeprom (U26) @ 1010111 0x57 */
+	carrier_eeprom: eeprom@57 {
+		compatible = "atmel,24c02";
+		reg = <0x57>;
+		pagesize = <16>;
+	};
+};
+
+&i2c1 {
+	/* routed to CSI connector (J10) */
+	/* routed to DSI connector (J15) */
+
+	touchscreen@41 {
+		compatible = "ilitek,ili2130", "ilitek,ili210x";
+		reg = <0x41>;
+	};
+
+	/* MIA-M10Q gps @ 0x42 (no driver, similar neo-m8 ) */
+	gnss@42 {
+		compatible = "u-blox,mia-m10", "u-blox,neo-m8";
+		reg = <0x42>;
+
+		/* reset-gpio at J7-32 floating on SoM */
+		/* interrupt at J7-34 floating on SoM */
+		/* pps at J7-30 floating on SoM */
+	};
+
+	/* SLG47115V (U22) high voltage programmable IO controller (no driver) */
+};
+
+&ohci0 {
+	dr_mode = "otg";
+	status = "okay";
+};
+
+&ohci1 {
+	dr_mode = "host";
+	status = "okay";
+};
+
+&pinctrl {
+	scif2_pins: scif-2-pins {
+		pinmux = <RZG2L_PORT_PINMUX(42, 0, 4)>, /* SCIF2_TXD */
+			 <RZG2L_PORT_PINMUX(42, 1, 4)>; /* SCIF2_RXD */
+	};
+
+	scif3_pins: scif-3-pins {
+		pinmux = <RZG2L_PORT_PINMUX(0, 0, 5)>, /* SCIF3_TXD */
+			 <RZG2L_PORT_PINMUX(0, 1, 5)>; /* SCIF3_RXD */
+	};
+
+	usb0_pins: usb-0-pins {
+		pinmux = <RZG2L_PORT_PINMUX(4, 0, 1)>; /* USB0_VBUSEN */
+	};
+
+	/* rs485 conflicts with on-som bluetooth, hog bt-reg-on */
+	som-bt-reg-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(23, 1) GPIO_ACTIVE_LOW>;
+		output-high;
+		line-name = "som-bt-reg";
+	};
+
+	/* lte reset */
+	/* TODO: replace with rfkill device for Linux v6.3 or later */
+	lte-reset-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(45, 3) GPIO_ACTIVE_LOW>;
+		input;
+		line-name = "lte-reset";
+	};
+
+	/* TODO: use with scif3 rts-gpios */
+	lte-rts-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(40, 2) GPIO_ACTIVE_LOW>;
+		output-high;
+		line-name = "lte-rts";
+	};
+
+	/*
+	 * mipi-dsi signals:
+	 *
+	 * RZ_DSI_DATA0_N: J5001-12
+	 * RZ_DSI_DATA0_P: J5001-14
+	 * RZ_DSI_DATA1_N: J5001-21
+	 * RZ_DSI_DATA1_P: J5001-23
+	 * RZ_DSI_DATA2_N: J5001-15
+	 * RZ_DSI_DATA2_P: J5001-17
+	 * RZ_DSI_DATA3_N: J5001-4
+	 * RZ_DSI_DATA3_P: J5001-6
+	 *
+	 * DSI_RESET:      J7-43, floating on SoM
+	 * DSI_STBY:       J7-47, floating on SoM
+	 *
+	 * DSI_PWM_BL:     J7-40, floating on SoM
+	 * DSI_L/R:        J7-37, floating on SoM
+	 * DSI_U/D:        J7-39, floating on SoM
+	 *
+	 * DSI_CTP_/RST:   J7-49, floating on SoM
+	 * DSI_INT#:       J7-45, floating on SoM
+	 */
+
+	/* PWR_OUT1 (J26-6) / DIG_OUT1 P39_1 */
+	/* PWR_OUT2 (J26-8) / DIG_OUT2 / clpd */
+	/* DIG_IN1 (J26-5) floating on SoM */
+	/* DIG_IN2 (J26-7) / bDIG_IN2 clpd / SLG_INT P42_2 */
+};
+
+&scif1 {
+	pinctrl-0 = <&scif1_pins>;
+	pinctrl-names = "default";
+	uart-has-rtscts;
+	status = "okay";
+
+	bluetooth {
+		compatible = "renesas,DA14531";
+		reset-gpios = <&pinctrl RZG2L_GPIO(45, 1) GPIO_ACTIVE_HIGH>;
+		max-speed = <1000000>;
+	};
+};
+
+/* RS485 */
+&scif2 {
+	pinctrl-0 = <&scif2_pins>;
+	pinctrl-names = "default";
+	/*
+	 * SCIF driver does not (currently) support RS485.
+	 * Disable flow-control so that simple tx/rx work,
+	 * production use however needs to implement proper support
+	 * to avoid collisions.
+	 *
+	 * SCIF can't support RS485 by native flow-control state-machine,
+	 * define RTS/CTS as GPIOs instead.
+	 *
+	 * cts-gpios = <&pinctrl RZG2L_GPIO(5, 1) GPIO_ACTIVE_LOW>;
+	 * rts-gpios = <&pinctrl RZG2L_GPIO(5, 2) GPIO_ACTIVE_LOW>;
+	 * uart-has-rtscts;
+	 * linux,rs485-enabled-at-boot-time;
+	 */
+	status = "okay";
+
+	/* conflict with on-som bluetooth */
+	/delete-node/ bluetooth;
+};
+
+/* LTE */
+&scif3 {
+	pinctrl-0 = <&scif3_pins>;
+	pinctrl-names = "default";
+	/*
+	 * SCIF driver does not support gpio rts/cts ...
+	 *
+	 * rts-gpios = <&pinctrl RZG2L_GPIO(40, 2) GPIO_ACTIVE_LOW>;
+	 */
+	status = "okay";
+};
+
+#if 0
+/* GPS */
+&scif4 {
+	/* uart signals floating on SoM */
+	/* reset-gpio at J7-32 floating on SoM */
+	/* interrupt at J7-34 floating on SoM */
+	/* pps at J7-30 floating on SoM */
+};
+#endif
+
+/* eMMC / SD */
+&sdhi0 {
+	pinctrl-0 = <&sdhi0_pins>;
+	pinctrl-1 = <&sdhi0_pins_uhs>;
+	pinctrl-names = "default", "state_uhs";
+	vmmc-supply = <&vdd_sd>;
+	vqmmc-supply = <&reg_sdhi0_vccq>; // on SoM
+	bus-width = <4>;
+	cd-gpios = <&pinctrl RZG2L_GPIO(18, 0) GPIO_ACTIVE_LOW>;
+	status = "okay";
+};
+
+&spi1 {
+	pinctrl-0 = <&spi1_pins>;
+	pinctrl-names = "default";
+	dmas = <&dmac 0x2e99>, <&dmac 0x2e9a>;
+	dma-names = "tx", "rx";
+	status = "okay";
+
+	wifi@0 {
+		compatible = "renesas,da16xxx";
+		reg = <0>;
+		spi-max-frequency = <25000000>;
+		reset-gpios = <&pinctrl RZG2L_GPIO(45, 0) GPIO_ACTIVE_LOW>; // RTC_PWR_KEY
+		irq0-gpios = <&pinctrl RZG2L_GPIO(45, 2) (GPIO_ACTIVE_LOW)>;
+	};
+};
+
+&usb2_phy0 {
+	pinctrl-0 = <&usb0_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+};
+
+&usb2_phy1 {
+	vbus-supply = <&vbus1>;
+	status = "okay";
+};
diff --git a/arch/arm64/configs/rz-solidrun_defconfig b/arch/arm64/configs/rz-solidrun_defconfig
index bc3c90b84..804038430 100644
--- a/arch/arm64/configs/rz-solidrun_defconfig
+++ b/arch/arm64/configs/rz-solidrun_defconfig
@@ -9,26 +9,21 @@ CONFIG_BSD_PROCESS_ACCT=y
 CONFIG_BSD_PROCESS_ACCT_V3=y
 CONFIG_TASK_XACCT=y
 CONFIG_TASK_IO_ACCOUNTING=y
-CONFIG_RCU_EXPERT=y
-CONFIG_TASKS_TRACE_RCU_READ_MB=y
 CONFIG_IKCONFIG=y
 CONFIG_IKCONFIG_PROC=y
 CONFIG_MEMCG=y
 CONFIG_BLK_CGROUP=y
 CONFIG_CGROUP_PIDS=y
-CONFIG_CGROUP_FREEZER=y
 CONFIG_CGROUP_HUGETLB=y
 CONFIG_CPUSETS=y
 CONFIG_CGROUP_DEVICE=y
 CONFIG_CGROUP_CPUACCT=y
 CONFIG_CGROUP_PERF=y
-CONFIG_CGROUP_BPF=y
 CONFIG_NAMESPACES=y
 CONFIG_USER_NS=y
 CONFIG_SCHED_AUTOGROUP=y
 CONFIG_BLK_DEV_INITRD=y
 CONFIG_EXPERT=y
-CONFIG_BPF_SYSCALL=y
 # CONFIG_COMPAT_BRK is not set
 CONFIG_PROFILING=y
 CONFIG_ARCH_RENESAS=y
@@ -846,11 +841,13 @@ CONFIG_NFS_V4_1=y
 CONFIG_NFS_V4_2=y
 CONFIG_NLS_CODEPAGE_437=y
 CONFIG_NLS_ISO8859_1=y
+CONFIG_INIT_STACK_NONE=y
 CONFIG_CRYPTO_ECDH=y
 CONFIG_CRYPTO_CMAC=y
 CONFIG_CRYPTO_DEFLATE=y
 CONFIG_CRYPTO_ANSI_CPRNG=y
 CONFIG_CRYPTO_DEV_CCREE=y
+CONFIG_CRC_T10DIF=y
 CONFIG_DMA_CMA=y
 # CONFIG_DMA_PERNUMA_CMA is not set
 CONFIG_CMA_SIZE_MBYTES=128
@@ -859,3 +856,14 @@ CONFIG_PRINTK_TIME=y
 CONFIG_DEBUG_FS=y
 # CONFIG_SCHED_DEBUG is not set
 # CONFIG_FTRACE is not set
+CONFIG_BT_HCIUART_RENESAS=y
+CONFIG_MAC80211=y
+CONFIG_GNSS=y
+CONFIG_GNSS_UBX_SERIAL=y
+CONFIG_PPS_CLIENT_GPIO=y
+CONFIG_TOUCHSCREEN_ILI210X=y
+CONFIG_DRM_PANEL_SIMPLE=y
+CONFIG_BACKLIGHT_GPIO=y
+# CONFIG_DEBUG_DRIVER is not set
+CONFIG_DYNAMIC_DEBUG=y
+CONFIG_DRM_PANEL_RONBO_RB070D30=y
-- 
2.43.0

